<div class="row">
  <div class="container-page">
    <h1 class="text-table">{{ textPage }}</h1>
    <p class="text-sub-table">
      <mat-icon>{{ constant_variables.ICON_INFORMATION }}</mat-icon
      >{{ subTextPage }}
    </p>
  </div>
</div>

<app-details-record [id]="perfilForm.controls['id'].value"></app-details-record>

<form [formGroup]="perfilForm">
  <div class="row">
    <div class="container-form-col">
      <mat-form-field appearance="outline" class="field-form">
        <mat-label hintLabel="máximo de 80 caracteres"
          >Digite o nome do perfil de acesso</mat-label
        >
        <input
          matInput
          placeholder="Digite o nome do perfil de acesso"
          maxlength="80"
          #nomePerfil
          formControlName="nomePerfil"
        />
        <mat-icon matSuffix class="mat-icon-actions">{{
          constant_variables.ICON_ACTION_LOCK
        }}</mat-icon>
        <mat-hint align="start" class="mat-icon-actions">{{
          constant_variables.ICON_ACTION_LOCK_LABEL
        }}</mat-hint>
        <mat-hint align="end" class="mat-icon-actions"
          >{{ nomePerfil.value.length }}/80</mat-hint
        >
      </mat-form-field>
    </div>
  </div>

  <div class="row">
    <div class="container-table" formArrayName="funcionalidades">
      <table mat-table [dataSource]="funcionalidadesFormArray.controls">
        <ng-container matColumnDef="funcionalidade">
          <th mat-header-cell *matHeaderCellDef>Funcionalidade</th>
          <td mat-cell *matCellDef="let row; let i = index" [formGroupName]="i">
            {{ row.value.nome }}
          </td>
        </ng-container>

        <ng-container matColumnDef="permissoes">
          <th mat-header-cell *matHeaderCellDef class="th-center">
            Permissões
          </th>
          <td
            mat-cell
            *matCellDef="let row; let i = index"
            [formGroupName]="i"
            class="td-center-chk-todos"
          >
            {{ row.value.funcionalidadeHabilitada }}
            <ng-container formArrayName="permissoes">
              <mat-checkbox
                *ngFor="
                  let ctrl of getPermissoesArray(i).controls;
                  let j = index
                "
                [formControlName]="j"
                (change)="verificarTodos(i)"
                [disabled]="row.value.funcionalidadeHabilitada"
              >
                {{ funcionalidadesMock[i].permissoes[j] }}
              </mat-checkbox>
            </ng-container>
          </td>
        </ng-container>

        <ng-container matColumnDef="todos">
          <th mat-header-cell *matHeaderCellDef class="th-center">
            Todos
          </th>
          <td
            mat-cell
            *matCellDef="let row; let i = index"
            [formGroupName]="i"
            class="td-center-chk-todos"
          >
            <mat-checkbox
              formControlName="todosSelecionado"
              (change)="toggleTodos(i)"
              [disabled]="true"
            ></mat-checkbox>
          </td>
        </ng-container>

        <tr
          mat-header-row
          *matHeaderRowDef="displayedColumns; sticky: true"
          class="tr-header"
        ></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
  </div>

  <div class="row">
    <div class="container-form-button">
      <button
        type="button"
        mat-flat-button
        class="btn-table"
        matTooltip="Voltar"
        [routerLink]="['/profiles']"
      >
        <mat-icon>{{ constant_variables.ICON_ACTION_UNDO }}</mat-icon>
        {{ constant_variables.ICON_ACTION_UNDO_LABEL }}
      </button>
    </div>
  </div>
</form>
